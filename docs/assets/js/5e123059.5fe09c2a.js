"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[67],{5923:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var o=t(4848),s=t(8453);const r={sidebar_position:1},i="Otoroshi cluster resources",a={id:"usage/resources",title:"Otoroshi cluster resources",description:"the main goal of otoroshictl is to help you manage your otoroshi cluster and its entities",source:"@site/docs/usage/resources.md",sourceDirName:"usage",slug:"/usage/resources",permalink:"/otoroshictl/docs/usage/resources",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Usage",permalink:"/otoroshictl/docs/category/usage"},next:{title:"Otoroshi cluster health",permalink:"/otoroshictl/docs/usage/health"}},c={},l=[{value:"List managed entities",id:"list-managed-entities",level:2},{value:"Entities CRUD",id:"entities-crud",level:2},{value:"Entities import",id:"entities-import",level:2},{value:"Entities export",id:"entities-export",level:2},{value:"Entities sync",id:"entities-sync",level:2},{value:"Entity templates",id:"entity-templates",level:2},{value:"Kubernetes commands",id:"kubernetes-commands",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"otoroshi-cluster-resources",children:"Otoroshi cluster resources"}),"\n",(0,o.jsxs)(n.p,{children:["the main goal of ",(0,o.jsx)(n.code,{children:"otoroshictl"})," is to help you manage your otoroshi cluster and its entities"]}),"\n",(0,o.jsx)(n.p,{children:"but first we need to know what entities are manageable"}),"\n",(0,o.jsx)(n.h2,{id:"list-managed-entities",children:"List managed entities"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl entities\n\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| kind              | singular_name      | plural_name         | group                              | version | served | deprecated | storage |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Route             | route              | routes              | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Backend           | backend            | backends            | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| RouteComposition  | route-composition  | route-compositions  | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| ServiceDescriptor | service-descriptor | service-descriptors | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| TcpService        | tcp-service        | tcp-services        | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| ErrorTemplate     | error-templates    | error-templates     | proxy.otoroshi.io                  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Apikey            | apikey             | apikeys             | apim.otoroshi.io                   | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Certificate       | certificate        | certificates        | pki.otoroshi.io                    | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| JwtVerifier       | jwt-verifier       | jwt-verifiers       | security.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| AuthModule        | auth-module        | auth-modules        | security.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| AdminSession      | admin-session      | admin-sessions      | security.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| SimpleAdminUser   | admins             | admins              | security.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| AuthModuleUser    | auth-module-user   | auth-module-users   | security.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| ServiceGroup      | service-group      | service-groups      | organize.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Organization      | organization       | organizations       | organize.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Tenant            | tenant             | tenants             | organize.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Team              | team               | teams               | organize.otoroshi.io               | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| DateExporter      | data-exporter      | data-exporters      | events.otoroshi.io                 | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| Script            | script             | scripts             | plugins.otoroshi.io                | v1      | true   | true       | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| WasmPlugin        | wasm-plugin        | wasm-plugins        | plugins.otoroshi.io                | v1      | true   | true       | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| GlobalConfig      | global-config      | global-configs      | config.otoroshi.io                 | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| GreenScore        | green-score        | green-scores        | green-score.extensions.otoroshi.io | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n| CorazaConfig      | coraza-config      | coraza-configs      | coraza-waf.extensions.otoroshi.io  | v1      | true   | false      | true    |\n+-------------------+--------------------+---------------------+------------------------------------+---------+--------+------------+---------+\n"})}),"\n",(0,o.jsxs)(n.p,{children:["now we can start working with the ",(0,o.jsx)(n.code,{children:"otoroshictl resources"})," commands"]}),"\n",(0,o.jsx)(n.h2,{id:"entities-crud",children:"Entities CRUD"}),"\n",(0,o.jsx)(n.p,{children:"you can list any kind of entity"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources get certificates\n\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| otoroshi-client                               | Otoroshi Default Client Certificate          | Otoroshi client certificate (auto-generated)     |         |  0   |    2     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| otoroshi-intermediate-ca                      | Otoroshi Default Intermediate CA Certificate | Otoroshi intermediate CA (auto-generated)        |         |  0   |    2     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| otoroshi-root-ca                              | Otoroshi Default Root CA Certificate         | Otoroshi root CA (auto-generated)                |         |  0   |    2     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| otoroshi-jwt-signing                          | Otoroshi Default Jwt Signing Keypair         | Otoroshi jwt signing keypair (auto-generated)    |         |  0   |    2     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| kubernetes-mesh-cert                          | Kubernetes Mesh Certificate                  | Kubernetes Mesh Certificate (auto-generated)     |         |  0   |    2     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n| kubernetes-webhooks-cert                      | Kubernetes Webhooks Certificate              | Kubernetes Webhooks Certificate (auto-generated) |         |  0   |    3     |\n+-----------------------------------------------+----------------------------------------------+--------------------------------------------------+---------+------+----------+\n"})}),"\n",(0,o.jsx)(n.p,{children:"get one"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources get certificates otoroshi-client\n\n+-----------------+-------------------------------------+----------------------------------------------+---------+------+----------+\n| id              | name                                | description                                  | enabled | tags | metadata |\n+-----------------+-------------------------------------+----------------------------------------------+---------+------+----------+\n| otoroshi-client | Otoroshi Default Client Certificate | Otoroshi client certificate (auto-generated) |         |  0   |    2     |\n+-----------------+-------------------------------------+----------------------------------------------+---------+------+----------+\n"})}),"\n",(0,o.jsxs)(n.p,{children:["(don't forget about the ",(0,o.jsx)(n.code,{children:"-o json"})," or ",(0,o.jsx)(n.code,{children:"-o yaml"})," flag for something more detailed)"]}),"\n",(0,o.jsx)(n.p,{children:"delete it"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources delete certificates otoroshi-client\n"})}),"\n",(0,o.jsx)(n.p,{children:"edit it"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources edit certificates otoroshi-client\n"})}),"\n",(0,o.jsx)(n.p,{children:"(it will open your current EDITOR)"}),"\n",(0,o.jsx)(n.p,{children:"and you can of course create entities like"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources create route \\\n  --data name=demootoroshictl \\\n  --data frontend.domain='demootoroshictl.oto.tools' \\\n  --data backend.target_url='https://mirror.otoroshi.io' \\\n  --data plugins.0.plugin='cp:otoroshi.next.plugins.ApikeyCalls' \\\n  --data plugins.1.plugin='cp:otoroshi.next.plugins.OverrideHost'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["(this syntax is also available on the ",(0,o.jsx)(n.code,{children:"edit"}),", and ",(0,o.jsx)(n.code,{children:"patch"})," commands)"]}),"\n",(0,o.jsx)(n.h2,{id:"entities-import",children:"Entities import"}),"\n",(0,o.jsx)(n.h2,{id:"entities-export",children:"Entities export"}),"\n",(0,o.jsx)(n.h2,{id:"entities-sync",children:"Entities sync"}),"\n",(0,o.jsx)(n.h2,{id:"entity-templates",children:"Entity templates"}),"\n",(0,o.jsx)(n.p,{children:"you can generate at any moment a template for any kind of entity"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ otoroshictl resources template apikey\n\n_loc:\n  teams:\n  - default\n  tenant: default\nallowClientIdOnly: false\nauthorizations: []\nauthorizedEntities: []\nauthorizedGroup: null\nclientId: kpw38ige9gw51ju6\nclientName: client-name-apikey\nclientSecret: 1oo2a4fishjvv8a7kn9sw984r44wc3bi4txioj0en20y2hy1uj7xk7ax78sonnis\nconstrainedServicesOnly: false\ndailyQuota: 10000000\ndescription: ''\nenabled: true\nmetadata: {}\nmonthlyQuota: 10000000\nreadOnly: false\nrestrictions:\n  allowLast: true\n  allowed: []\n  enabled: false\n  forbidden: []\n  notFound: []\nrotation:\n  enabled: false\n  gracePeriod: 168\n  nextSecret: null\n  rotationEvery: 744\ntags: []\nthrottlingQuota: 10000000\nvalidUntil: null\n"})}),"\n",(0,o.jsx)(n.h2,{id:"kubernetes-commands",children:"Kubernetes commands"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"otoroshictl"})," can help you generate your ",(0,o.jsx)(n.code,{children:"rbac"})," and ",(0,o.jsx)(n.code,{children:"crds"})," manifests"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ otoroshictl resources crds\n\n---\napiVersion: "apiextensions.k8s.io/v1"\nkind: "CustomResourceDefinition"\nmetadata:\n  name: "routes.proxy.otoroshi.io"\nspec:\n  group: "proxy.otoroshi.io"\n  names:\n    kind: "Route"\n    plural: "routes"\n    singular: "route"\n  scope: "Namespaced"\n  versions:\n  - name: "v1alpha1"\n    served: false\n    storage: false\n    deprecated: true\n    schema:\n      openAPIV3Schema:\n        x-kubernetes-preserve-unknown-fields: true\n        type: "object"\n  - name: "v1"\n    served: true\n    storage: true\n    deprecated: false\n    schema:\n      openAPIV3Schema:\n        x-kubernetes-preserve-unknown-fields: true\n        type: "object"\n---\napiVersion: "apiextensions.k8s.io/v1"\nkind: "CustomResourceDefinition"\nmetadata:\n  name: "backends.proxy.otoroshi.io"\nspec:\n  group: "proxy.otoroshi.io"\n  names:\n    kind: "Backend"\n    plural: "backends"\n    singular: "backend"\n  scope: "Namespaced"\n  versions:\n  - name: "v1alpha1"\n    served: false\n    storage: false\n    deprecated: true\n    schema:\n      openAPIV3Schema:\n        x-kubernetes-preserve-unknown-fields: true\n        type: "object"\n  - name: "v1"\n    served: true\n    storage: true\n    deprecated: false\n    schema:\n      openAPIV3Schema:\n        x-kubernetes-preserve-unknown-fields: true\n        type: "object"\n...\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'$ otoroshictl resources rbac\n\n---\nkind: ServiceAccount\napiVersion: v1\nmetadata:\n    name: otoroshi-admin-user\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n    name: otoroshi-admin-user\nroleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: ClusterRole\n    name: otoroshi-admin-user\nsubjects:\n- kind: ServiceAccount\n    name: otoroshi-admin-user\n    namespace: $namespace\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n    name: otoroshi-admin-user\nrules:\n    - apiGroups:\n        - ""\n    resources:\n        - services\n        - endpoints\n        - secrets\n        - configmaps\n        - deployments\n        - namespaces\n        - pods\n    verbs:\n        - get\n        - list\n        - watch\n    - apiGroups:\n        - "apps"\n    resources:\n        - deployments\n    verbs:\n        - get\n        - list\n        - watch\n    - apiGroups:\n        - ""\n    resources:\n        - secrets\n        - configmaps\n    verbs:\n        - update\n        - create\n        - delete\n    - apiGroups:\n        - extensions\n    resources:\n        - ingresses\n        - ingressclasses\n    verbs:\n        - get\n        - list\n        - watch\n    - apiGroups:\n        - extensions\n    resources:\n        - ingresses/status\n    verbs:\n        - update\n    - apiGroups:\n        - admissionregistration.k8s.io\n    resources:\n        - validatingwebhookconfigurations\n        - mutatingwebhookconfigurations\n    verbs:\n        - get\n        - update\n        - patch\n    - apiGroups:\n        - proxy.otoroshi.io\n    resources:\n        - routes\n        - backends\n        - route-compositions\n        - service-descriptors\n        - tcp-services\n        - error-templates\n        - apikeys\n        - certificates\n        - jwt-verifiers\n        - auth-modules\n        - admin-sessions\n        - admins\n        - auth-module-users\n        - service-groups\n        - organizations\n        - tenants\n        - teams\n        - data-exporters\n        - scripts\n        - wasm-plugins\n        - global-configs\n        - green-scores\n        - coraza-configs\n    verbs:\n        - get\n        - list\n        - watch\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);